<?phpnamespace App\Http\Controllers;use App\Keyword;use Illuminate\Http\Request;class DownloadController extends Controller{	public function download(Request $req) {		$target = $req->input('target');		switch ($target) {			case 'keywordResult':				$this->createKeywordExcel();				return response()->download(public_path().'/result.xlsx');			case 'keywordLog':				return response()->download(public_path().'/log.xlsx');		}	}	protected function createKeywordExcel() {		$total = Keyword::all()->count();		$objPHPExcel = new \PHPExcel();		$sheet = $objPHPExcel->getActiveSheet();		$sheet->fromArray([			'关键词',			'PC端URL',			'PC端URL排名',			'PC端URL昨日抓取情况',			'移动端URL',			'移动端URL排名',			'移动端URL昨日抓取情况',			'期望landing类目',			'备注',			'添加者',			'添加时间',			'最近更新时间'		],			null,			'A1');		$j = 1;		for($i = 0 ; $i < ceil($total / 1000); $i++) {			$buffer = Keyword::orderBy('updated_at', 'ASC')->skip($i * 1000)->take(1000)->get();			foreach ($buffer as $keyword) {				$j++;				$sheet->fromArray([					$keyword->name,					$keyword->PCUrl,					$keyword->PRank,					$keyword->PCSpiderStatus,					$keyword->mobileUrl,					$keyword->mobileRank,					$keyword->mobileSpiderStatus,					$keyword->expectation,					$keyword->notes,					$keyword->author,					$keyword->created_at,					$keyword->updated_at,				],					null,					'A'.$j);			}		}		$objWriter = \PHPExcel_IOFactory::createWriter($objPHPExcel, "Excel2007");		$objWriter->save(public_path().'/result.xlsx');	}}